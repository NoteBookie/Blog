---
layout: page
title: hack(Shanghai)比赛记录
categories:
    - cookies
---

上个礼拜（11/7~11/8）我和院里的小伙伴们约好去参加了上纽大搞的hackathon活动。到今天为止，hackathon已经过去一个礼拜了，一些对当时生产出的代码的反yuan思nian，以及想要记录下这次行走的冲动使我决定写点什么<del>（内心：别让这个博客被JOS统治）</del>。

### **Start**

这是上纽大办的第二届hackShanghai了，因为从学长那里收获到了对于这个hackathon很好的风评，所以这次得知消息后也就干脆的报名了。初到上海纽约大学的时候还是狠狠的shock了一把的，从没想过大学能是一栋楼来着……习惯了每个地点之间都要自行车出行的我无疑还是觉得电梯更酷一些。

因为提前两天从微信群里收到了一个硬件列表，所以我和小伙伴在一番讨论后，选定了其中一个叫做pebble的智能手表，准备码一个多人联机的文字游戏。我们简单的聊了一下文字游戏的主题和主线剧情的大致样子，觉得cool enough后，就在周六上路了。

### **idea**

7号下午两点开始编程，期间到5点可以借硬件。借硬件的过程很波折，因为pebble手表被鸽了，据说是赞助商退出了（…）。我和cyx两人在硬件的柜台前想要看一些别的东西，但是这一届hackShanghai的设备感觉均偏向更基础的板子，同类型的开发经验在我们组里只有cyx稍有涉猎，所以被我们统统否决。留下少量的leapmotion（被玩过realsense的我们一致踢开）和VR设备（很快被借光了），两手空空的我们回来开始了长达一小时的组会……最终依然决定坚持我们原先的想法，干脆甩开硬件。

我们的想法是一个三人的三天冒险故事：三人流落荒岛，需要齐心协力生存10天。我们的任务就是实现一个基本的游戏框架：服务器协调好三个人的事件列表，不断的让他们进入新的剧情；我们只要写一两个剧情，其余的编剧工作不一定非要在hackathon上完成。

### **脑洞**

其实这个idea的诞生经历过很多脑洞和对现实因素的考量。我一开始的想法是做一个7-70岁的模拟，玩家和玩家的交互要更加自然，比如：两个同时进入到小学时间段的玩家会自然而然的触发好友的剧情，玩家和玩家之间可以扮演父母和子女。不过这个idea太过于Idealized了，不仅需求过分多的剧本量，服务器的同步也很困难。另一方面，我们组的开发经验不多，如果是一个复杂的应用，24小时不一定驾驭的了，因此最好把展示方式限制在简单的App/插件/简单的web上。

脑洞自然而然的过度到了“荒岛求生”上，我们又产生了分歧：一方面觉得应该尽力丰富剧情，让这个游戏看上去更有艺术感；另一方面，大家也觉得，如果做一个20分钟就可以打完的桌游性质的博弈游戏也不错。后来，我们决定综合两方面，把游戏的内容划分为“剧情”和“事件”两类，引入轻量的博弈内容。

### **具体**

我们设计了一下我们的工作：
* 首先，我们需要三段前置剧情以确保玩家在现实中的一天时间足以进行一场游戏。
* 其次，在游戏真正开始后（三人匹配完成），服务器需要同步三人的个人信息（食物/饮水/工具/虚弱度），也需要同步三人共有的一些资源（营地/食物/饮水/工具）。
* 最后，服务器需要在“事件”发生时将事件推送给三个客户端（客户端的轮询）。

我们需要的东西是：剧本/客户端（提供给用户的选择界面/展示）/服务器（同步）

### **coding**

因为我事先捧着一本《2666》写了一些短剧情，所以我决定先搞定文字工作。Tjg和Skj分别写了两段登岛后的探索剧情，我把三人登岛前的前置剧情完成了。这一部分说来容易，其实花费了非常大的精力去试图保证剧情的可玩性和艺术感。有测评的人说过：玩游戏的人对游戏最关注的部分就是前十五分钟，经过此役，我深以为然。

到晚上晚饭前完成了一个简单的和客户端通信的服务器，可以实现在前置剧情后同步信息。到这时，完成度都还挺高的，可惜后来进度不佳。

晚饭后继续码，我事后深深觉得自己写服务器的初始思路有些问题：不应该直接从socket开始的，应该先设计一套restful的API才对。

因为没找到可穿戴设备，负责pebble的Skj无事可做，我就把服务器的游戏逻辑部分丢给他，自己来写与客户端的通信部分（事后证明分成两人来做是不太好），cyx把所有的剧情都转变成了json格式的文本文件，然后协助Tjg在android上修改展示效果。

TimeFlies，一直到晚上三点左右，我们开始合并工作。最大的败笔出现于此：那就是游戏逻辑和通信部分合并后，我写的单元测试是有问题的。在四点后，我一直等待着Tjg那里的android部分与我进行测试，却没想到自己写的多线程模型是有问题的……而我写的单元测试本质上来说是一个用户一个线程的，在android上，真正的设定是应用每次都会创建新线程来和我链接。

我把每局游戏存在一个列表里，每个列表维护三个消息队列，每次玩家步进了剧情，我就将剧情树步进一步，然后把新的消息压到消息队列里。坏就坏在这剧情树上！因为到了早上五点后人处于被怼晕的状态，而且缺乏和Skj的交流沟通，他写的剧情树的步进不是一个线程安全的步进（当然也不应该是，应该是由我保证线程的安全），但是这个bug我们发现的非常非常非常晚，我一度怀疑自己整个多线程都是写崩的，花了很多无谓的时间打印信息来测试（多线程的测试，你懂的）。在结束整个活动后，我才确认了自己其他部分的多线程的正确性，明白了自己真正的失误所在。

### **Report**

真真没想到的是一个歪国光头大叔对着我们的项目“wowowow”，“socooool”，“yesyes”了一番，当时我的内心是十分十分十分愧疚的，因为我觉得是我的原因导致了整个完成度不够高。但是他显然被前5分钟的剧情树和我们的idea给误导了（三个前置剧情的复杂度很高，但是是单机的…），误以为整个游戏的流程都是这样的剧情，其实我们还没精力制作出整个剧情（所以说游戏前十五分钟最重要了=-=）。

##### **番外**

回到学校给别的小伙伴玩了下，他们竟然也觉得玩上去很cool……令我确信游戏制作者不喜欢玩自己的游戏也是真的……

### **花絮**

* 这里的staff的英语力太高了，让我产生了强烈的羡慕的情绪。
* 饮食不怎么样：第一天晚上默默的排了两轮披萨，吃了三根鱼条；但是第二天竟然什么也没吃，肚子里是thread在飞扬。
* 我们背后那组谈笑风声的歪国人到底去哪儿了……
* 评选出的9强里的打飞机和裸眼3D强烈的舒缓了我的愧疚感，因为实在是太水了。
* 最喜欢的是搜索视频直接播放的chrome插件<del>（我才不会说出是因为上台展示的妹子很萌这种原因！）</del>